version: 2
jobs:
  build:
    docker:
      - image: circleci/golang:1.9
    working_directory: /go/src/github.com/y-yagi/jpcal

    steps:
      - checkout
      - run:
          name : Run dep
          command: |
            go get -u github.com/golang/dep/cmd/dep
            dep ensure
      - run:
          name: Run vet
          command: go vet
      - run:
          name: Run lint
          command: |
            go build ./vendor/github.com/golang/lint/golint
            ./golint -set_exit_status
      - run:
          name: Run tests
          command: go test -v
  dep-update:
    docker:
      - image: circleci/golang:1.9
    working_directory: /go/src/github.com/y-yagi/jpcal
    name: Continuous dep update

    steps:
      - run:
        name: Run ci-dep-update
        command: |
          go get -u github.com/y-yagi/ci-dep-update
          ci-dep-update -u y-yagi -r y-yagi/jpcal

workflows:
   version: 2
   nightly:
     triggers:
       - schedule:
           cron: "0 0 * * *"
           filters:
             branches:
               only:
                 - master
     jobs:
      - dep-update

